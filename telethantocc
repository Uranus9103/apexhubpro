local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TextChatService = game:GetService("TextChatService")
local player = Players.LocalPlayer

-- GUI ch√≠nh
local gui = Instance.new("ScreenGui")
gui.Name = "TPGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- N√∫t b·∫≠t/t·∫Øt TP
local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0,140,0,50)
btn.Position = UDim2.new(0.05,0,0.1,0)
btn.Text = "‚ùå TP OFF"
btn.TextScaled = true
btn.BackgroundColor3 = Color3.fromRGB(200,50,50)
btn.TextColor3 = Color3.fromRGB(255,255,255)
btn.Font = Enum.Font.GothamBold
btn.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0,12)
corner.Parent = btn

local shadow = Instance.new("UIStroke")
shadow.Color = Color3.fromRGB(0,0,0)
shadow.Thickness = 2
shadow.Transparency = 0.4
shadow.Parent = btn

btn.Active = true
btn.Draggable = true

-- Frame danh s√°ch
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,220,0,300)
frame.Position = UDim2.new(0.05,0,0.22,0)
frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
frame.Visible = false
frame.Parent = gui

local fcorner = Instance.new("UICorner")
fcorner.CornerRadius = UDim.new(0,12)
fcorner.Parent = frame

-- N√∫t t·∫£i l·∫°i danh s√°ch
local reloadBtn = Instance.new("TextButton")
reloadBtn.Size = UDim2.new(1,-20,0,40)
reloadBtn.Position = UDim2.new(0,10,0,10)
reloadBtn.Text = "üîÑ T·∫£i l·∫°i"
reloadBtn.TextScaled = true
reloadBtn.BackgroundColor3 = Color3.fromRGB(100,100,100)
reloadBtn.TextColor3 = Color3.fromRGB(255,255,255)
reloadBtn.Font = Enum.Font.GothamBold
reloadBtn.Parent = frame

local rc = Instance.new("UICorner")
rc.CornerRadius = UDim.new(0,8)
rc.Parent = reloadBtn

-- ScrollingFrame danh s√°ch
local scroll = Instance.new("ScrollingFrame")
scroll.Size = UDim2.new(1,-20,1,-60)
scroll.Position = UDim2.new(0,10,0,55)
scroll.CanvasSize = UDim2.new(0,0,0,0)
scroll.ScrollBarThickness = 6
scroll.ScrollBarImageColor3 = Color3.fromRGB(150,150,150)
scroll.BackgroundTransparency = 1
scroll.Parent = frame

-- Tr·∫°ng th√°i TP
local tpEnabled = false
btn.MouseButton1Click:Connect(function()
	tpEnabled = not tpEnabled
	if tpEnabled then
		btn.Text = "‚úÖ TP ON"
		btn.BackgroundColor3 = Color3.fromRGB(50,200,50)
		frame.Visible = true
	else
		btn.Text = "‚ùå TP OFF"
		btn.BackgroundColor3 = Color3.fromRGB(200,50,50)
		frame.Visible = false
	end
end)

-- G·ª≠i chat to√†n server
local function sendChatMessage(text)
	if TextChatService.ChatVersion == Enum.ChatVersion.TextChatService then
		local channel = TextChatService.TextChannels:FindFirstChild("RBXGeneral")
		if channel then
			channel:SendAsync(text)
		end
	else
		local chatRemote = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
		if chatRemote and chatRemote:FindFirstChild("SayMessageRequest") then
			chatRemote.SayMessageRequest:FireServer(text, "All")
		end
	end
end

-- T·∫°o n√∫t ng∆∞·ªùi ch∆°i
local function createPlayerButton(plr, index)
	if plr == player then return end
	
	local pbtn = Instance.new("TextButton")
	pbtn.Size = UDim2.new(1, -10, 0, 40)
	pbtn.Position = UDim2.new(0, 5, 0, (index-1)*45 )
	pbtn.Text = plr.Name
	pbtn.TextScaled = true
	pbtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
	pbtn.TextColor3 = Color3.fromRGB(255,255,255)
	pbtn.Font = Enum.Font.GothamBold
	pbtn.Parent = scroll

	local pc = Instance.new("UICorner")
	pc.CornerRadius = UDim.new(0,8)
	pc.Parent = pbtn

	pbtn.MouseButton1Click:Connect(function()
		if tpEnabled and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
				player.Character.HumanoidRootPart.CFrame =
					plr.Character.HumanoidRootPart.CFrame + Vector3.new(3,0,0)

				-- Chat to√†n server
				sendChatMessage("tp_" .. plr.Name)

				-- Hi·ªáu ·ª©ng ƒë·ªïi m√†u n√∫t khi ch·ªçn
				pbtn.BackgroundColor3 = Color3.fromRGB(50,200,50)
				task.delay(1, function()
					if pbtn then
						pbtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
					end
				end)
			end
		end
	end)
end

-- Update danh s√°ch
local function updateList()
	for _,child in pairs(scroll:GetChildren()) do
		if child:IsA("TextButton") then
			child:Destroy()
		end
	end

	local index = 1
	for _,plr in pairs(Players:GetPlayers()) do
		if plr ~= player then
			createPlayerButton(plr, index)
			index += 1
		end
	end

	scroll.CanvasSize = UDim2.new(0,0,0,(index-1)*45)
end

-- B·∫•m n√∫t t·∫£i l·∫°i th√¨ refresh danh s√°ch
reloadBtn.MouseButton1Click:Connect(updateList)

-- T·ª± c·∫≠p nh·∫≠t khi c√≥ ng∆∞·ªùi v√†o/ra
Players.PlayerAdded:Connect(updateList)
Players.PlayerRemoving:Connect(updateList)
updateList()
