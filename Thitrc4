local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- T·∫°o GUI
local gui = Instance.new("ScreenGui")
gui.Name = "BaseESP"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- ƒê·∫∑t t√™n folder ch·ª©a Base trong workspace
local baseFolder = workspace:WaitForChild("Bases") -- üëà ch·ªó n√†y b·∫°n ƒë·ªïi ƒë√∫ng t√™n folder base trong game

-- L∆∞u ESP labels
local espLabels = {}

-- H√†m t·∫°o label ESP
local function createESP(base)
	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(0,200,0,20)
	label.BackgroundTransparency = 1
	label.TextColor3 = Color3.fromRGB(255,50,50)
	label.TextStrokeTransparency = 0.3
	label.Font = Enum.Font.SourceSansBold
	label.TextScaled = true
	label.Text = "[BASE] " .. base.Name
	label.Parent = gui
	espLabels[base] = label
end

-- H√†m x√≥a ESP
local function removeESP(base)
	if espLabels[base] then
		espLabels[base]:Destroy()
		espLabels[base] = nil
	end
end

-- T·∫°o ESP cho c√°c base hi·ªán c√≥
for _,base in pairs(baseFolder:GetChildren()) do
	if base:IsA("Model") or base:IsA("Part") then
		createESP(base)
	end
end

-- N·∫øu c√≥ base m·ªõi spawn
baseFolder.ChildAdded:Connect(function(base)
	if base:IsA("Model") or base:IsA("Part") then
		createESP(base)
	end
end)

-- N·∫øu base b·ªã xo√°
baseFolder.ChildRemoved:Connect(function(base)
	removeESP(base)
end)

-- C·∫≠p nh·∫≠t v·ªã tr√≠ ESP li√™n t·ª•c
RunService.RenderStepped:Connect(function()
	for base,label in pairs(espLabels) do
		local pos
		if base:IsA("Model") and base:FindFirstChild("PrimaryPart") then
			pos = base.PrimaryPart.Position
		elseif base:IsA("Part") then
			pos = base.Position
		end

		if pos then
			local vector, onScreen = camera:WorldToViewportPoint(pos)
			if onScreen then
				label.Position = UDim2.new(0, vector.X - 100, 0, vector.Y - 10)
				label.Visible = true
				label.Text = string.format("[BASE] %s (%.0f)", base.Name, (player.Character and player.Character:FindFirstChild("HumanoidRootPart") and (player.Character.HumanoidRootPart.Position - pos).Magnitude) or 0)
			else
				label.Visible = false
			end
		end
	end
end)
