--// APEX HUB ‚Äì Key H·ªá Th·ªëng (Key 1-5 lu√¢n phi√™n theo ng√†y + L∆∞u Data 24h)
local Players = game:GetService("Players")
local DataStoreService = game:GetService("DataStoreService")
local player = Players.LocalPlayer
local HttpService = game:GetService("HttpService")

-- DataStore (l∆∞u th·ªùi gian nh·∫≠p key)
local keyStore = DataStoreService:GetDataStore("APEX_KeySystem")

-- Danh s√°ch Key v√† Link
local Keys = {
    "Free_APEX382938@31",  -- Ng√†y 1
    "Free_tifsefujdAPEX38@137", -- Ng√†y 2
    "Free_keythdiigeeir2@53fAPEX", -- Ng√†y 3
    "Free_tiumiadiynh;APEX", -- Ng√†y 4
    "Free_APEX38229@thf" -- Ng√†y 5
}
local Links = {
    "https://link4m.com/nlKZuX",
    "https://link4m.com/5r6sBMNm",
    "https://link4m.com/s7SIonha",
    "https://link4m.com/H53VgZ",
    "https://link4m.com/Cxct1"
}

-- X√°c ƒë·ªãnh ng√†y ƒë·ªÉ ch·ªçn key
local unixUTC = DateTime.now().UnixTimestamp
local unixLocal = unixUTC + 7*3600 -- offset +7 gi·ªù
local index = (math.floor(unixLocal / 86400) % 5) + 1

local CorrectKey = Keys[index]
local KeyLink = Links[index]

-- H√†m ki·ªÉm tra ƒë√£ nh·∫≠p key ch∆∞a (trong 24h)
local function hasValidKey()
    local success, lastTime = pcall(function()
        return keyStore:GetAsync(player.UserId)
    end)
    if success and lastTime then
        if os.time() - lastTime < 86400 then -- nh·ªè h∆°n 24h
            return true
        end
    end
    return false
end

-- H√†m l∆∞u th·ªùi gian nh·∫≠p key
local function saveKeyTime()
    pcall(function()
        keyStore:SetAsync(player.UserId, os.time())
    end)
end

-- H√†m ch·∫°y script ch√≠nh
local function runMainScript()
    local runBtn = Instance.new("TextButton")
    runBtn.Size = UDim2.new(0, 220, 0, 65)
    runBtn.Position = UDim2.new(0.5, -110, 0.5, -32)
    runBtn.Text = "üöÄ Ch·∫°y Script"
    runBtn.Font = Enum.Font.GothamBold
    runBtn.TextScaled = true
    runBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    runBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    runBtn.AutoButtonColor = false
    Instance.new("UICorner", runBtn).CornerRadius = UDim.new(0, 15)
    Instance.new("UITextSizeConstraint", runBtn).MaxTextSize = 22
    runBtn.Parent = player.PlayerGui

    local stroke2 = Instance.new("UIStroke", runBtn)
    stroke2.Thickness = 3
    task.spawn(function()
        local hue = 0
        while runBtn and runBtn.Parent do
            hue = (hue + 1) % 360
            runBtn.BackgroundColor3 = Color3.fromHSV(hue/360, 0.8, 1)
            stroke2.Color = Color3.fromHSV(((hue + 180) % 360) / 360, 1, 1)
            task.wait()
        end
    end)

    runBtn.MouseButton1Click:Connect(function()
        runBtn.Text = "ƒêang t·∫£i..."
        pcall(function()
            loadstring(game:HttpGet("https://raw.githubusercontent.com/Uranus9103/Subcakehub/refs/heads/main/Thu10"))()
        end)
        runBtn:Destroy()
    end)
end

-- N·∫øu ƒë√£ nh·∫≠p key trong 24h ‚Üí ch·∫°y script lu√¥n
if hasValidKey() then
    runMainScript()
    return
end

-- N·∫øu ch∆∞a ‚Üí hi·ªán GUI nh·∫≠p key
local gui = Instance.new("ScreenGui")
gui.Name = "APEX_Key_GUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 340, 0, 200)
frame.Position = UDim2.new(0.5, -170, 0.5, -100)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BackgroundTransparency = 0.05
frame.Parent = gui
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 14)

local stroke = Instance.new("UIStroke", frame)
stroke.Thickness = 3
task.spawn(function()
    local hue = 0
    while task.wait() do
        hue = (hue + 1) % 360
        stroke.Color = Color3.fromHSV(hue/360, 1, 1)
    end
end)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, -20, 0, 40)
title.Position = UDim2.new(0, 10, 0, 8)
title.BackgroundTransparency = 1
title.Text = "üîë H·ªÜ TH·ªêNG NH·∫¨P KEY | APEX HUB"
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextScaled = true
Instance.new("UITextSizeConstraint", title).MaxTextSize = 22

local box = Instance.new("TextBox", frame)
box.Size = UDim2.new(0.9, 0, 0, 40)
box.Position = UDim2.new(0.05, 0, 0.45, 0)
box.PlaceholderText = "Nh·∫≠p Key"
box.Text = ""
box.TextScaled = true
box.TextWrapped = true
box.TextXAlignment = Enum.TextXAlignment.Center
box.TextYAlignment = Enum.TextYAlignment.Center
box.Font = Enum.Font.Gotham
box.TextColor3 = Color3.fromRGB(255, 255, 255)
box.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Instance.new("UICorner", box).CornerRadius = UDim.new(0, 8)
Instance.new("UITextSizeConstraint", box).MaxTextSize = 20

local confirmBtn = Instance.new("TextButton", frame)
confirmBtn.Size = UDim2.new(0.42, 0, 0, 38)
confirmBtn.Position = UDim2.new(0.05, 0, 0.75, 0)
confirmBtn.Text = "‚úÖ Confirm"
confirmBtn.Font = Enum.Font.GothamBold
confirmBtn.TextScaled = true
confirmBtn.TextColor3 = Color3.new(1,1,1)
confirmBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
confirmBtn.AutoButtonColor = false
Instance.new("UICorner", confirmBtn).CornerRadius = UDim.new(0, 8)
Instance.new("UITextSizeConstraint", confirmBtn).MaxTextSize = 18

local getKeyBtn = Instance.new("TextButton", frame)
getKeyBtn.Size = UDim2.new(0.42, 0, 0, 38)
getKeyBtn.Position = UDim2.new(0.53, 0, 0.75, 0)
getKeyBtn.Text = "üåê Get Key"
getKeyBtn.Font = Enum.Font.GothamBold
getKeyBtn.TextScaled = true
getKeyBtn.TextColor3 = Color3.new(1,1,1)
getKeyBtn.BackgroundColor3 = Color3.fromRGB(0, 85, 170)
getKeyBtn.AutoButtonColor = false
Instance.new("UICorner", getKeyBtn).CornerRadius = UDim.new(0, 8)
Instance.new("UITextSizeConstraint", getKeyBtn).MaxTextSize = 18

getKeyBtn.MouseButton1Click:Connect(function()
    if setclipboard then
        setclipboard(KeyLink)
    end
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "Th√¥ng b√°o",
        Text = "‚úÖ ƒê√£ copy link Get Key v√†o clipboard!",
        Duration = 4
    })
end)

confirmBtn.MouseButton1Click:Connect(function()
    if box.Text == CorrectKey then
        saveKeyTime()
        gui:Destroy()
        runMainScript()
    else
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "‚ùå Sai Key",
            Text = "Vui l√≤ng nh·∫≠p l·∫°i!",
            Duration = 3
        })
    end
end)
