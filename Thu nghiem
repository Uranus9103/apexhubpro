-- LocalScript trong StarterGui
local player = game.Players.LocalPlayer
local uis = game:GetService("UserInputService")
local rs = game:GetService("RunService")

-- Tạo ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "FlyGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Cụm nút di chuyển (draggable frame)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 250, 0, 250)
mainFrame.Position = UDim2.new(0.7, 0, 0.5, 0)
mainFrame.BackgroundTransparency = 1
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = gui

-- Hàm tạo nút
local function createButton(name, text, posX, posY)
	local btn = Instance.new("TextButton")
	btn.Name = name
	btn.Size = UDim2.new(0, 80, 0, 80)
	btn.Position = UDim2.new(0, posX, 0, posY)
	btn.Text = text
	btn.TextScaled = true
	btn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	btn.BorderSizePixel = 4
	btn.Parent = mainFrame
	return btn
end

-- Tạo nút
local upBtn = createButton("Up", "↑", 85, 0)
local downBtn = createButton("Down", "↓", 85, 170)
local toggleBtn = createButton("Toggle", "Bật", 85, 85)
local plusBtn = createButton("Plus", "+", 170, 0)
local minusBtn = createButton("Minus", "-", 0, 0)

-- Hiệu ứng cầu vồng
local function rainbow(btn)
	spawn(function()
		while true do
			for hue = 0, 255, 4 do
				btn.BackgroundColor3 = Color3.fromHSV(hue/255, 1, 1)
				btn.BorderColor3 = Color3.fromHSV((hue+50)/255, 1, 1)
				task.wait(0.03)
			end
		end
	end)
end

rainbow(upBtn)
rainbow(downBtn)
rainbow(toggleBtn)
rainbow(plusBtn)
rainbow(minusBtn)

-- Fly system
local flying = false
local speed = 50
local velocity = Vector3.zero

toggleBtn.MouseButton1Click:Connect(function()
	flying = not flying
	toggleBtn.Text = flying and "Tắt" or "Bật"
	if not flying then
		if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			player.Character.HumanoidRootPart.Anchored = false
		end
	end
end)

plusBtn.MouseButton1Click:Connect(function()
	speed = speed + 10
end)

minusBtn.MouseButton1Click:Connect(function()
	speed = math.max(1, speed - 10)
end)

-- Điều khiển bay
local movingUp = false
local movingDown = false

upBtn.MouseButton1Down:Connect(function() movingUp = true end)
upBtn.MouseButton1Up:Connect(function() movingUp = false end)
downBtn.MouseButton1Down:Connect(function() movingDown = true end)
downBtn.MouseButton1Up:Connect(function() movingDown = false end)

rs.RenderStepped:Connect(function()
	if flying and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
		local hrp = player.Character.HumanoidRootPart
		local camCF = workspace.CurrentCamera.CFrame
		local moveDir = Vector3.zero

		if uis:IsKeyDown(Enum.KeyCode.W) then
			moveDir = moveDir + camCF.LookVector
		end
		if uis:IsKeyDown(Enum.KeyCode.S) then
			moveDir = moveDir - camCF.LookVector
		end
		if uis:IsKeyDown(Enum.KeyCode.A) then
			moveDir = moveDir - camCF.RightVector
		end
		if uis:IsKeyDown(Enum.KeyCode.D) then
			moveDir = moveDir + camCF.RightVector
		end
		if movingUp then
			moveDir = moveDir + Vector3.new(0, 1, 0)
		end
		if movingDown then
			moveDir = moveDir - Vector3.new(0, 1, 0)
		end

		if moveDir.Magnitude > 0 then
			moveDir = moveDir.Unit
		end

		hrp.Velocity = moveDir * speed
		hrp.Anchored = false
	end
end)
