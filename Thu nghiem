-- LocalScript trong StarterGui

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local RS = game:GetService("RunService")

local flying = false
local flySpeed = 50
local flyHeightSpeed = 2
local rainbowColors = {}
local colorIndex = 1

-- Hàm tạo màu cầu vồng
for i = 0, 1, 0.02 do
	table.insert(rainbowColors, Color3.fromHSV(i, 1, 1))
end

-- Tạo ScreenGui
local gui = Instance.new("ScreenGui")
gui.Name = "FlyGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Hàm tạo nút
local function createButton(name, text, pos, size)
	local btn = Instance.new("TextButton")
	btn.Name = name
	btn.Text = text
	btn.Size = size
	btn.Position = pos
	btn.BackgroundColor3 = rainbowColors[1]
	btn.BorderSizePixel = 4
	btn.TextScaled = true
	btn.Parent = gui
	btn.Font = Enum.Font.GothamBold
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.BackgroundTransparency = 0.1
	btn.AutoButtonColor = false
	btn.BorderColor3 = rainbowColors[1]
	btn.AnchorPoint = Vector2.new(0.5, 0.5)
	btn.ZIndex = 2
	btn.TextStrokeTransparency = 0.5
	return btn
end

-- Nút
local btnFlyOn = createButton("FlyOn", "Bật Bay", UDim2.new(0.9, 0, 0.6, 0), UDim2.new(0.15, 0, 0.08, 0))
local btnFlyOff = createButton("FlyOff", "Tắt Bay", UDim2.new(0.9, 0, 0.7, 0), UDim2.new(0.15, 0, 0.08, 0))
local btnUp = createButton("Up", "UP", UDim2.new(0.9, 0, 0.45, 0), UDim2.new(0.15, 0, 0.08, 0))
local btnDown = createButton("Down", "DOWN", UDim2.new(0.9, 0, 0.55, 0), UDim2.new(0.15, 0, 0.08, 0))
local btnPlus = createButton("Plus", "+", UDim2.new(0.78, 0, 0.6, 0), UDim2.new(0.1, 0, 0.08, 0))
local btnMinus = createButton("Minus", "-", UDim2.new(0.78, 0, 0.7, 0), UDim2.new(0.1, 0, 0.08, 0))

-- Cập nhật màu liên tục
RS.RenderStepped:Connect(function()
	colorIndex = colorIndex % #rainbowColors + 1
	local color = rainbowColors[colorIndex]
	for _, button in pairs(gui:GetChildren()) do
		if button:IsA("TextButton") then
			button.BackgroundColor3 = color
			button.BorderColor3 = color
		end
	end
end)

-- Bay
local function fly()
	local hrp = player.Character:FindFirstChild("HumanoidRootPart")
	local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
	if not hrp or not humanoid then return end

	local bv = Instance.new("BodyVelocity")
	bv.Velocity = Vector3.new(0,0,0)
	bv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
	bv.Parent = hrp

	local bg = Instance.new("BodyGyro")
	bg.CFrame = hrp.CFrame
	bg.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
	bg.Parent = hrp

	RS.RenderStepped:Connect(function()
		if flying then
			local camCF = workspace.CurrentCamera.CFrame
			local moveDir = humanoid.MoveDirection
			bv.Velocity = (camCF.LookVector * moveDir.Z + camCF.RightVector * moveDir.X) * flySpeed + Vector3.new(0, bv.Velocity.Y, 0)
			bg.CFrame = CFrame.new(hrp.Position, hrp.Position + camCF.LookVector)
		else
			bv:Destroy()
			bg:Destroy()
		end
	end)
end

-- Sự kiện nút
btnFlyOn.MouseButton1Click:Connect(function()
	flying = true
	fly()
end)

btnFlyOff.MouseButton1Click:Connect(function()
	flying = false
end)

btnUp.MouseButton1Click:Connect(function()
	if flying then
		local hrp = player.Character:FindFirstChild("HumanoidRootPart")
		if hrp then
			hrp.Velocity = hrp.Velocity + Vector3.new(0, flyHeightSpeed, 0)
		end
	end
end)

btnDown.MouseButton1Click:Connect(function()
	if flying then
		local hrp = player.Character:FindFirstChild("HumanoidRootPart")
		if hrp then
			hrp.Velocity = hrp.Velocity - Vector3.new(0, flyHeightSpeed, 0)
		end
	end
end)

btnPlus.MouseButton1Click:Connect(function()
	flySpeed = flySpeed + 5
end)

btnMinus.MouseButton1Click:Connect(function()
	flySpeed = math.max(5, flySpeed - 5)
end)
