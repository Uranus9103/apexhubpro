-- ESP Camera + Auto GUI
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local RunService = game:GetService("RunService")
local Camera = workspace.CurrentCamera

-- ===== Tạo GUI tự động =====
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ESPGui"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Nút bật/tắt ESP
local ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleESP"
ToggleButton.Size = UDim2.new(0,120,0,40)
ToggleButton.Position = UDim2.new(0.05,0,0.05,0)
ToggleButton.Text = "Bật ESP"
ToggleButton.Parent = ScreenGui

-- Frame danh sách người chơi
local PlayerListFrame = Instance.new("Frame")
PlayerListFrame.Name = "PlayerListFrame"
PlayerListFrame.Size = UDim2.new(0,200,0,300)
PlayerListFrame.Position = UDim2.new(0.05,0,0.12,0)
PlayerListFrame.Visible = false
PlayerListFrame.BackgroundColor3 = Color3.fromRGB(30,30,30)
PlayerListFrame.Parent = ScreenGui

local ScrollingFrame = Instance.new("ScrollingFrame")
ScrollingFrame.Size = UDim2.new(1,0,1,0)
ScrollingFrame.CanvasSize = UDim2.new(0,0,0,0)
ScrollingFrame.ScrollBarThickness = 6
ScrollingFrame.Parent = PlayerListFrame

-- ===== State =====
local ESPEnabled = false

-- ===== Hàm cập nhật danh sách người chơi =====
local function updatePlayerList()
    ScrollingFrame:ClearAllChildren()
    local yOffset = 0
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local btn = Instance.new("TextButton")
            btn.Size = UDim2.new(1,0,0,30)
            btn.Position = UDim2.new(0,0,0,yOffset)
            btn.Text = player.Name
            btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
            btn.TextColor3 = Color3.fromRGB(255,255,255)
            btn.Parent = ScrollingFrame

            btn.MouseButton1Click:Connect(function()
                if ESPEnabled and player.Character then
                    local humanoid = player.Character:FindFirstChild("Humanoid")
                    if humanoid then
                        Camera.CameraSubject = humanoid
                    end
                end
            end)

            yOffset = yOffset + 35
        end
    end
    ScrollingFrame.CanvasSize = UDim2.new(0,0,0,yOffset)
end

-- ===== Bật/Tắt ESP =====
ToggleButton.MouseButton1Click:Connect(function()
    ESPEnabled = not ESPEnabled
    if ESPEnabled then
        ToggleButton.Text = "Tắt ESP"
        PlayerListFrame.Visible = true
        updatePlayerList()
    else
        ToggleButton.Text = "Bật ESP"
        PlayerListFrame.Visible = false
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            Camera.CameraSubject = LocalPlayer.Character.Humanoid
        end
    end
end)

-- ===== Cập nhật khi có người vào/ra =====
Players.PlayerAdded:Connect(function()
    if ESPEnabled then updatePlayerList() end
end)

Players.PlayerRemoving:Connect(function()
    if ESPEnabled then updatePlayerList() end
end)
