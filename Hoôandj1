-- LocalScript hoàn chỉnh fix swap

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local TweenService = game:GetService("TweenService")

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "ControlGui"
gui.Parent = player:WaitForChild("PlayerGui")

local dropButton = Instance.new("TextButton")
dropButton.Size = UDim2.new(0,150,0,50)
dropButton.Position = UDim2.new(0,50,0,50)
dropButton.Text = "Rớt Part"
dropButton.BackgroundColor3 = Color3.fromRGB(255,100,100)
dropButton.Parent = gui

local swapButton = Instance.new("TextButton")
swapButton.Size = UDim2.new(0,150,0,50)
swapButton.Position = UDim2.new(0,50,0,120)
swapButton.Text = "Hoán Đổi"
swapButton.BackgroundColor3 = Color3.fromRGB(100,255,100)
swapButton.Parent = gui

-- Tạo Part demo nếu chưa có
local targetPart = workspace:FindFirstChild("DemoPart")
if not targetPart then
    targetPart = Instance.new("Part")
    targetPart.Size = Vector3.new(4,4,4)
    targetPart.Position = player.Character and player.Character.HumanoidRootPart.Position + Vector3.new(0,5,5) or Vector3.new(0,5,0)
    targetPart.Anchored = true
    targetPart.CanCollide = true
    targetPart.Name = "DemoPart"
    targetPart.Parent = workspace
end

-- Rớt Part
dropButton.MouseButton1Click:Connect(function()
    if targetPart then
        targetPart.Anchored = false
        targetPart.CanCollide = true
        print("Part đã rớt!")
    end
end)

-- Hoán đổi vị trí (fix tự reset)
swapButton.MouseButton1Click:Connect(function()
    if targetPart and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local charRoot = player.Character.HumanoidRootPart
        local playerPos = charRoot.Position
        local partPos = targetPart.Position

        -- Hoán đổi Part
        targetPart.CFrame = CFrame.new(playerPos + Vector3.new(0,3,0)) -- tránh chạm
        -- Di chuyển người chơi bằng Tween để tránh reset
        local tweenInfo = TweenInfo.new(0.2) -- 0.2s mượt
        local tween = TweenService:Create(charRoot, tweenInfo, {CFrame = CFrame.new(partPos + Vector3.new(0,3,0))})
        tween:Play()
        print("Hoán đổi vị trí thành công!")
    end
end)
