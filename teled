local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "TPGui"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Nút bật/tắt
local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0,140,0,50)
btn.Position = UDim2.new(0.1,0,0.1,0)
btn.Text = "❌ TP OFF"
btn.TextScaled = true
btn.BackgroundColor3 = Color3.fromRGB(200,50,50)
btn.TextColor3 = Color3.fromRGB(255,255,255)
btn.Font = Enum.Font.GothamBold
btn.Parent = gui

-- Bo góc
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0,12)
corner.Parent = btn

-- Viền
local shadow = Instance.new("UIStroke")
shadow.Color = Color3.fromRGB(0,0,0)
shadow.Thickness = 2
shadow.Transparency = 0.4
shadow.Parent = btn

-- Cho kéo nút
btn.Active = true
btn.Draggable = true

-- Trạng thái
local tpEnabled = false
btn.MouseButton1Click:Connect(function()
	tpEnabled = not tpEnabled
	if tpEnabled then
		btn.Text = "✅ TP ON"
		btn.BackgroundColor3 = Color3.fromRGB(50,200,50)
	else
		btn.Text = "❌ TP OFF"
		btn.BackgroundColor3 = Color3.fromRGB(200,50,50)
	end
end)

-- Hàm tìm player
local function findPlayerByName(name)
	name = string.lower(name)
	for _,plr in pairs(Players:GetPlayers()) do
		if string.find(string.lower(plr.Name), name, 1, true) then
			return plr
		end
	end
	return nil
end

-- Bắt chat qua ChatEvents (chuẩn hơn player.Chatted)
local chatEvent = ReplicatedStorage:WaitForChild("DefaultChatSystemChatEvents")
	:WaitForChild("OnMessageDoneFiltering")

chatEvent.OnClientEvent:Connect(function(msgData)
	if not tpEnabled then return end
	if msgData.FromSpeaker ~= player.Name then return end -- chỉ lệnh mình gõ

	local msg = msgData.Message
	if string.sub(msg, 1, 4) == "/tp_" then
		local targetName = string.sub(msg, 5)
		local targetPlayer = findPlayerByName(targetName)

		if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
			if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
				player.Character.HumanoidRootPart.CFrame =
					targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(3,0,0)

				-- Thông báo thành công
				local hint = Instance.new("Hint", workspace)
				hint.Text = "✅ Dịch chuyển tới " .. targetPlayer.Name
				game:GetService("Debris"):AddItem(hint, 2)
			end
		else
			local hint = Instance.new("Hint", workspace)
			hint.Text = "❌ Không tìm thấy: " .. targetName
			game:GetService("Debris"):AddItem(hint, 3)
		end
	end
end)
