-- Chạy script GitHub của bạn trước
pcall(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/vinh12eqweaws/vvvs/refs/heads/main/caz"))()
end)

-- Khai báo dịch vụ
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- RemoteEvent để đồng bộ tàng hình với người khác
local toggleEvent = ReplicatedStorage:FindFirstChild("ToggleInvisibility") or Instance.new("RemoteEvent")
toggleEvent.Name = "ToggleInvisibility"
toggleEvent.Parent = ReplicatedStorage

-- Server xử lý ẩn hiện
if not _G.InvisibleServerSetup then
    _G.InvisibleServerSetup = true
    toggleEvent.OnServerEvent:Connect(function(player, state)
        for _, otherPlayer in pairs(Players:GetPlayers()) do
            if otherPlayer ~= player then
                toggleEvent:FireClient(otherPlayer, player, state)
            end
        end
    end)
end

-- Hàm ẩn/hiện nhân vật
local function setCharacterInvisible(char, state)
    for _, part in ipairs(char:GetDescendants()) do
        if part:IsA("BasePart") or part:IsA("Decal") then
            part.Transparency = state and 1 or 0
            if part:IsA("BasePart") then
                part.CanCollide = not state
            end
        end
    end
end

-- GUI nút
local screenGui = Instance.new("ScreenGui")
screenGui.ResetOnSpawn = false
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 180, 0, 60)
button.Position = UDim2.new(1, -200, 1, -100)
button.Text = "Bật Tàng Hình"
button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Font = Enum.Font.SourceSansBold
button.TextSize = 20
button.AutoButtonColor = false
button.Parent = screenGui

-- Viền đổi màu
local uiStroke = Instance.new("UIStroke")
uiStroke.Thickness = 3
uiStroke.Parent = button

task.spawn(function()
    local hue = 0
    while button.Parent do
        hue = (hue + 1) % 360
        uiStroke.Color = Color3.fromHSV(hue / 360, 1, 1)
        task.wait(0.03)
    end
end)

-- Kéo thả mượt
local dragging, dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    button.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

button.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = button.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

button.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- Trạng thái tàng hình
local isInvisible = false
local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()

-- Bấm nút để bật/tắt
button.MouseButton1Click:Connect(function()
    isInvisible = not isInvisible
    setCharacterInvisible(character, isInvisible)
    toggleEvent:FireServer(isInvisible)
    button.Text = isInvisible and "Tắt Tàng Hình" or "Bật Tàng Hình"
end)

-- Nhận lệnh từ server để ẩn/hiện người chơi khác
toggleEvent.OnClientEvent:Connect(function(targetPlayer, state)
    local char = targetPlayer.Character
    if char then
        setCharacterInvisible(char, state)
    end
end)

-- Khi respawn vẫn giữ trạng thái
LocalPlayer.CharacterAdded:Connect(function(newChar)
    character = newChar
    if isInvisible then
        setCharacterInvisible(character, true)
        toggleEvent:FireServer(true)
    end
end)
